version: '3.8'

# 生产环境覆盖配置
services:
  mysql:
    command: --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      --max_connections=200
    ports: []  # 生产环境不暴露端口

  redis:
    ports: []  # 生产环境不暴露端口

  springai-backend:
    environment:
      JAVA_OPTS: "-Xms1g -Xmx2g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
    ports: []  # 生产环境不暴露端口，只通过 Nginx 访问
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G

  springai-mcp-server:
    environment:
      JAVA_OPTS: "-Xms512m -Xmx1g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
    ports: []  # 生产环境只在内部网络使用
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
        reservations:
          cpus: '0.25'
          memory: 512M

  nginx:
    ports:
      - "8085:80"
      - "8443:443"  # HTTPS
    volumes:
      - ./nginx/ssl:/etc/nginx/ssl:ro  # SSL 证书（可选）